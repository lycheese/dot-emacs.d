#+TITLE: Doom Emacs Configuration
* Font
#+begin_src elisp
;; Doom exposes five (optional) variables for controlling fonts in Doom. Here
;; are the three important ones:
;;
;; + `doom-font'
;; + `doom-variable-pitch-font'
;; + `doom-big-font' -- used for `doom-big-font-mode'; use this for
;;   presentations or streaming.
;;
;; They all accept either a font-spec, font string ("Input Mono-12"), or xlfd
;; font string. You generally only need these two:
;; (setq doom-font (font-spec :family "monospace" :size 12 :weight 'semi-light)
;;       doom-variable-pitch-font (font-spec :family "sans" :size 13))
(pcase (system-name)
  ("nanocore" (setq doom-font (font-spec :family "Hack Nerd Font Mono" :size 13.0)))
  ("nanorocket" (setq doom-font (font-spec :family "FiraCode Nerd Font Mono" :size 11.0)))
  ("pop-os" (setq doom-font (font-spec :family "Fira Code" :size 13.0)))
  (_ (message "No font for this hostname defined")))
#+end_src
* Formatting
#+begin_src elisp
;;; Nix
(set-formatter! 'nixpkgs-fmt "nixpkgs-fmt" :modes '(nix-mode))
;;; Dockerfile
;; (set-formatter! 'none "none" :modes '(dockerfile-mode))
(setq-hook! 'dockerfile-mode-hook +format-with :none)
#+end_src
* Gnus
#+begin_src elisp
(use-package! gnus
  :config
  (setq gnus-select-method '(nnnil nil)))
#+end_src
* Hyperbole
#+begin_src elisp
(use-package! hyperbole
  :bind ("C-h h". hyperbole)
  :bind* (("M-<RET>" . hkey-either )
          ("M-∃" . action-key)
          ("M-ℕ" . assist-key)))
#+end_src
* Identity
#+begin_src elisp
;; Some functionality uses this to identify you, e.g. GPG configuration, email
;; clients, file templates and snippets.
(setq user-full-name "Elia Nolz"
      user-mail-address "elia@nolz.org")
#+end_src
* Keybindings
#+begin_src elisp
(map! :map ivy-minibuffer-map "<right>" 'ivy-alt-done)
(map! :g "C-&" 'other-window)
(map! :map key-translation-map "C-ü" "C-x")

(map! :g "C-c a" 'org-agenda-list
      :g "C-c c" 'org-capture)

(map! :nv "g s <down>" 'evilem-motion-next-line
      :nv "g s <up>" 'evilem-motion-previous-line)

(map! :nv "ü" 'evil-snipe-repeat)
#+end_src
* Line numbers
#+begin_src elisp
;; This determines the style of line numbers in effect. If set to `nil', line
;; numbers are disabled. For relative line numbers, set this to `relative'.
(setq display-line-numbers-type nil)
#+end_src
* Mouse highlight
#+begin_src elisp
(setq mouse-highlight nil)
#+end_src
* mu4e
#+begin_src elisp
(unless (string-equal (system-name) "pop-os")
  (add-to-list 'load-path "/run/current-system/sw/share/emacs/site-lisp/mu4e/"))

(set-email-account! "lycheese-mailo"
                    '((mu4e-sent-folder   . "/lycheese-mailo/sent")
                      (mu4e-drafts-folder . "/lycheese-mailo/draftbox")
                      (mu4e-trash-folder  . "/lycheese-mailo/Trash")
                      (smtpmail-smtp-user . "fixme")))
(set-email-account! "uni"
                    '((mu4e-sent-folder      . "/nb191/Sent")
                      (mu4e-drafts-folder    . "/nb191/Drafts")
                      (mu4e-trash-folder     . "/nb191/Trash")
                      (smtpmail-smtp-user    . "nb191@stud.uni-heidelberg.de")
                      (smtpmail-smtp-server  . "mail.urz.uni-heidelberg.de")
                      (smtpmail-smtp-service . 587)))
#+end_src
* Org
#+begin_src elisp
;; If you use `org' and don't want your org files in the default location below,
;; change `org-directory'. It must be set before org loads!
(setq org-directory "~/org/")
#+end_src

#+begin_src elisp :noweb yes
;;; Org
(after! org
  ;; General org settings
  (setq org-log-into-drawer t
        org-id-link-to-org-use-id 'use-existing
        org-startup-folded t
        evil-org-special-o/O '(table-row item))

  ;; Org agenda settings
  (setq org-agenda-files (cl-remove-if (lambda (x) (string-match "fs[567]" x)) (directory-files-recursively org-directory "org$"))
        org-agenda-span 'day
        org-agenda-start-day nil)
  (add-to-list 'org-modules 'org-habit)
  (general-advice-add '(org-agenda-quit org-agenda-switch-to) :before 'org-save-all-org-buffers)

  <<org-super-agenda-config>>

  ;; Org archive settings
  (setq org-archive-location "~/org/archive.org::* From %s")

  ;; Org capture templates
  <<org-capture-templates>>

  ;; Org todo keywords
  <<org-todo-states>>)
#+end_src
** org-todo-states
#+name: org-todo-states
#+begin_src elisp :tangle no
(setq org-todo-keywords '((sequence "TODO(t)"
                                    "PROJ(p)"
                                    "STRT(s@)"
                                    "WAIT(w@/!)"
                                    "HOLD(h@/!)"
                                    "IDEA(i)"
                                    "FILE(f@)"
                                    "|"
                                    "DONE(d!)"
                                    "KILL(k@)")
                          (sequence "[ ](T)"
                                    "[-](S)"
                                    "[?](W)"
                                    "|"
                                    "[X](D)")
                          (sequence "|"
                                    "OKAY(o)"
                                    "YES(y)"
                                    "NO(n)")))

(add-to-list 'org-todo-keyword-faces '("FILE" . +org-todo-active))
#+end_src
** org-super-agenda
#+name: org-super-agenda-config
#+begin_src elisp :tangle no
(use-package org-super-agenda
    :hook (org-agenda-mode . org-super-agenda-mode)
    :init
    (setq org-super-agenda-groups
          '((:name "Habits"
             :habit t
             :order 2)
            (:name "Today"
             :time-grid t
             :todo "TODAY"
             :scheduled today
             :order 1)
            (:name "Important"
             :tag "Important"
             :tag "Family"
             :order 1)
            (:name "Critically overdue"
             :and (:deadline past
                   :not (:todo "FILE"))
             :order 0)
            (:name "Overdue Uni Stuff"
             :and (:scheduled past
                   :tag "Uni"
                   :not (:todo "FILE"))
             :order 3)
            (:name "Uni Stuff to be filed"
             :and (:tag "Uni"
                   :todo "FILE")
             :order 4)
            (:name "University Stuff"
             :tag "Uni"
             :order 3)
            (:name "Completed projects that still need to be filed away"
             :todo "FILE"
             :order 95)
            (:name "Scheduled Projects"
             :todo "PROJ"
             :order 97)
            (:name "Emacs Stuff"
             :tag "Emacs"
             :order 98)
            (:name "Reading"
             :tag "Books"
             :order 96)
            (:name "Overdue"
             :and  (:scheduled past
                    :not (:todo "PROJ"))
             :order 1)))
    :config
    (setq org-super-agenda-header-map (make-sparse-keymap)))
#+end_src
** org-capture-templates
#+name: org-capture-templates
#+begin_src elisp :tangle no :noweb yes
(setq org-capture-templates
      '(;; Noweb import of the respective templates
        <<org-capture-tasks>>

        <<org-capture-projects>>

        <<org-capture-notes>>

        <<org-capture-anki>>

        <<org-capture-contacts>>

        <<org-capture-japanese>>))
#+end_src
*** org-capture-tasks
#+name: org-capture-tasks
#+begin_src elisp :tangle no
("t" "Tasks")
("tt" "Task for today" entry
 (file+olp+datetree "notes.org")
 "* %^{Select type|TODO|WAIT|HOLD|KILL|DONE} %^{Task} %^G\n SCHEDULED: %t\n%?\nAdded: %U")
("ts" "Scheduled task" entry
 (file+olp+datetree "notes.org")
 "* %^{Select type|TODO|WAIT|HOLD|KILL|DONE} %^{Task} %^G\n SCHEDULED: %^t\n%?\nAdded: %U")
("td" "Scheduled task with deadline" entry
 (file+olp+datetree "notes.org")
 "* %^{Select type|TODO|WAIT|HOLD|KILL|DONE} %^{Task} %^G\n DEADLINE: %^t\n%?\nAdded: %U")
("tn" "Not scheduled task" entry
 (file+olp+datetree "notes.org")
 "* %^{Select type|TODO|WAIT|HOLD|KILL|DONE} %^{Task} %^G\n%?\nAdded: %U")
#+end_src
*** org-capture-projects
#+begin_src elisp :tangle no
("p" "Project" entry
 (file+olp+datetree "notes.org")
 "* PROJ %^{Project} %^G\n%?\nAdded: %U")
#+end_src
*** org-capture-notes
#+name: org-capture-notes
#+begin_src elisp :tangle no
("n" "Notes" entry
 (file+olp+datetree "notes.org")
 "* %U %^{Title} %^G\n%?")
#+end_src
*** org-capture-anki
#+name: org-capture-anki
#+begin_src elisp :tangle no
("a" "Anki Cards")
("ab" "Anki Basic Block I" entry
 (file+olp+datetree "anki.org" "Block I")
 "* %<%H:%M:%S>  %^g
:PROPERTIES:
:ANKI_NOTE_TYPE: Org-Import
:ANKI_DECK: Block I
:ANKI_TAGS: FS7
:END:
,** Front
%?
,** Back
%i")
#+end_src
*** org-capture-contacts
#+name: org-capture-contacts
#+begin_src elisp :tangle no
("c" "Contacts")
("cp" "Private contact" entry
 (file+olp "contacts.org" "Kontakte" "Privat")
 "* %^{Name}\n Email: %^{Email}\nTelephone: %^{Telephone number}\n** TODO Geburtstag von %\\1\nSCHEDULED: %^{Birthday}t"
 :immediate-finish t)
("cf" "Family contact" entry
 (file+olp "contacts.org" "Kontakte" "Familie")
 "* %^{Name}\n Email: %^{Email}\nTelephone: %^{Telephone number}\n** TODO Geburtstag von %\\1\nSCHEDULED: %^{Birthday}t"
 :immediate-finish t)
("cw" "Work contact" entry
 (file+olp "contacts.org" "Kontakte" "Arbeit")
 "* %^{Name}\n Email: %^{Email}\nTelephone: %^{Telephone number}\n** TODO Geburtstag von %\\1\nSCHEDULED: %^{Birthday}t"
 :immediate-finish t)
("co" "Other contacts" entry
 (file+olp "contacts.org" "Kontakte" "Andere")
 "* %^{Name}\n Email: %^{Email}\nTelephone: %^{Telephone number}\n** TODO Geburtstag von %\\1\nSCHEDULED: %^{Birthday}t"
 :immediate-finish t)
("cn" "New contact template" entry
 (file+olp "contacts.org" "Kontakte" "Testbereich")
 "* %^{Name}
:PROPERTIES:
:EMAIL: %^{Email}
:PHONE: %^{Telefon}
:ALIAS: %^{Alias}
:ADDRESS: %^{Adresse}
:END:
,,** TODO Geburtstag von %\\1
SCHEDULED:%^{Geburtstag}t %?")
#+end_src
*** org-capture-japanese
#+name: org-capture-japanese
#+begin_src elisp :tangle no
("j" "Japanese vocab")
("jn" "Japanese noun" entry
 (file+olp+datetree "hobby/japanese.org" "Vocab" "Noun")
 "* %^{Japanese} \[%^{Reading}\] %^g
Translation: %^{English}
New Kanji?: %^{New Kanji?|Yes|No}
Additional stuff: %?")
("jv" "Japanese verb" entry
 (file+olp+datetree "hobby/japanese.org" "Vocab" "Verb")
 "* %^{Japanese} \[%^{Reading}\] %^g
Translation: %^{English}
New Kanji?: %^{New Kanji?|Yes|No}
Type: %^{Ichidan or Godan?|Ichidan|Godan} and %^{Transitivity|Transitive|Intransitive}
Additional stuff: %?")
("ja" "Japanese adjective" entry
 (file+olp+datetree "hobby/japanese.org" "Vocab" "Adjective")
 "* %^{Japanese} \[%^{Reading}\] %^g
Translation: %^{English}\nNew Kanji?: %^{New Kanji?|Yes|No}
Type: %^{i-adj or na-adj|i-adj|na-adj}
Additional stuff: %?")
("jo" "Other japanese vocab" entry
 (file+olp+datetree "hobby/japanese.org" "Vocab" "Other")
 "* %^{Japanese} \[%^{Reading}\] %^g
Translation: %^{English}
New Kanji?: %^{New Kanji?|Yes|No}
Additional stuff: %?")
#+end_src
* Programming
** Scheme
#+begin_src elisp
;; (after! geiser
;;   (setq geiser-active-implementations '("guile")))
#+end_src
* Theme
#+begin_src elisp
;; There are two ways to load a theme. Both assume the theme is installed and
;; available. You can either set `doom-theme' or manually load a theme with the
;; `load-theme' function. This is the default:
(setq doom-theme 'doom-one)
#+end_src
